# this program is to generate seurat objects of each condition to be used in pyscenic analyses.
# First it imports cells clustering from seur_clust_source seurat object generated by Mengdi using SeqGeq to 
# seur_counts_source generated by Diala using R. Second, it filters out outlier genes. Then it saves a seurat 
# object for each condition. Finally, it creates a seurat object from the clusters of interest 
# (Ctrl C1+C4 vs Tum_unt C2 vs Tum_DT C3 vs Tum_CTl4 C5 vs tum_CTLA4_DT C6)

setwd('~/projects/sabelo/AB_seq_v2/')
library(Seurat)

seur  = readRDS("results/Seurat_AB_seq/Tum_CD8_v3/Seur_Tum_CD8_clustered.rds")
seur$seurat_clusters = seur$wsnn_res.0.4
saveRDS(seur, file="results/Seurat_AB_seq/Tum_CD8_v3/Seurat/Seur_Tum_CD8_clustered.rds")


seur$seurat_clusters = paste(seur$sample, seur$wsnn_res.0.4, sep='.C')
seur  = subset(seur, seurat_clusters %in% c('Tum_WT.C0', 'Tum_KO.C3'))
saveRDS(seur, file=paste0('results/Seurat_AB_seq/Tum_CD8_v3/Seurat/Seur_Tum_CD8_KO.C3_WT.C0_clustered.rds'))